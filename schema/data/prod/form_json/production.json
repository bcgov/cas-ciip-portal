{
  "schema": {
    "type": "array",
    "items": {
      "$ref": "#/definitions/product"
    },
    "definitions": {
      "product": {
        "type": "object",
        "properties": {
          "productRowId": {
            "title": "Product or Service",
            "type": "integer"
          },
          "quantity": {
            "title": "Annual Production Amount",
            "type": "number"
          },
          "productUnits": {
            "title": "Units",
            "type": "string"
          },
          "requiresEmissionAllocation": {
            "type": "boolean"
          },
          "isProductionAmountOptional": {
            "type": "boolean"
          }
        },

        "dependencies": {
          "requiresEmissionAllocation": {
            "oneOf": [
              {
                "properties": {
                  "requiresEmissionAllocation": {
                    "const": false
                  }
                }
              },
              {
                "properties": {
                  "productEmissions": {
                    "title": "Emissions allocated to product",
                    "type": "number",
                    "exclusiveMinimum": 0
                  },
                  "requiresEmissionAllocation": {
                    "const": true
                  }
                },
                "required": ["productEmissions"]
              }
            ]
          },
          "isProductionAmountOptional" : {
            "oneOf": [{
              "properties": {
                "isProductionAmountOptional": { "const": true }
              },
              "required": ["productRowId", "productUnits"]
            },
            {
              "properties": {
                "isProductionAmountOptional": { "const": false }
              },
              "required": ["productRowId", "quantity", "productUnits"]
            }]
          }
        }
      }
    }
  },
  "uiSchema": {
    "ui:add-text": "Add a Product",
    "ui:remove-text": "Remove Product",
    "items": {
      "ui:field": "product",
      "ui:order": ["productRowId", "quantity", "productUnits", "*"],
      "productRowId": {
        "ui:col-md": 12,
        "ui:widget": "SearchWidget",
        "ui:field": "productRowId"
      },
      "quantity": {
        "ui:col-md": 4,
        "ui:help": "Report the annual production for the product, following the guidance document provided"
      },
      "productUnits": {
        "ui:col-md": 4,
        "ui:readonly": true
      },
      "productEmissions": {
        "ui:col-md": 4,
        "ui:help": "Report emissions associated to CIIP product, in tCO2e"
      },
      "requiresEmissionAllocation": { "ui:widget": "hidden" },
      "isProductionAmountOptional": { "ui:widget": "hidden" }
    }
  }
}
